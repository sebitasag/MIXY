<!DOCTYPE html> <!-- Indica que el documento usa HTML5 -->
<html lang="es"> <!-- El idioma principal del documento es español -->

<head> <!-- Inicio del encabezado del sitio (configuración, estilos, meta datos) -->

  <meta charset="UTF-8"> <!-- Define codificación UTF-8 para admitir acentos y caracteres especiales -->

  <meta name="viewport" content="width=980, initial-scale=1.0">
  <!-- Configura el tamaño de la vista en móviles (ancho fijo de 980px) -->

  <title>Mixy - Login & Registro</title> <!-- Título que se muestra en la pestaña del navegador -->

  <!-- Carga iconos desde Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

  <!-- Carga fuentes desde Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <!-- Archivo CSS principal del proyecto -->
  <link rel="stylesheet" href="/static/style.css">

</head> <!-- Fin del head -->

<body> <!-- Inicio del contenido visible de la página -->

  <div class="container" id="main-container"> <!-- Contenedor principal -->

    <!-- ======================== SECCIÓN LOGIN ======================== -->
    <div class="form-section" id="login-section"> <!-- Sección del formulario de login -->

      <div class="logo-login"> <!-- Contenedor del logo y nombre -->
        <i class="fas fa-circle-play"></i> <!-- Ícono del logo -->
        <h1>mixy</h1> <!-- Título del proyecto -->
      </div>

      <h2>Iniciar Sesión</h2> <!-- Título del formulario -->

      <form id="login-form"> <!-- Formulario de login -->

        <div class="input-box"> <!-- Caja de entrada para correo -->
          <i class="fas fa-envelope"></i> <!-- Icono -->
          <input type="email" name="loginCorreo" placeholder="Correo electrónico" required> <!-- Campo email -->
        </div>

        <div class="input-box"> <!-- Caja de entrada para contraseña -->
          <i class="fas fa-lock"></i> <!-- Icono -->
          <input type="password" name="loginClave" placeholder="Contraseña" required> <!-- Campo password -->
        </div>

        

        <div class="error-message" id="login-error"></div> <!-- Div para mostrar errores de login -->

        <button type="submit"> <!-- Botón de ingresar -->
          <i class="fas fa-right-to-bracket"></i> <!-- Icono -->
          INGRESAR
        </button>

      </form> <!-- Fin formulario login -->

      <a href="#" id="OlvidoContraseñaEnlace" class="forgot-link"> <!-- Enlace recuperación contraseña -->
        <i class="fas fa-question-circle"></i> <!-- Icono -->
        ¿Olvidaste tu contraseña?
      </a>

    </div> <!-- Fin login section -->

    <!-- ======================== SECCIÓN REGISTRO ======================== -->
    <div class="form-section hidden" id="registro-section"> <!-- Sección oculta de registro -->

      <div class="logo-login"> <!-- Logo igual que en login -->
        <i class="fas fa-circle-play"></i>
        <h1>mixy</h1>
      </div>

      <h2>Crear Cuenta</h2> <!-- Título del registro -->

      <form id="registro-form"> <!-- Formulario registro -->

        <div class="input-row"> <!-- Fila que contiene nombre y apellido -->

          <div class="input-box half"> <!-- Caja para nombre -->
            <i class="fas fa-user"></i>
            <input type="text" id="nombre" name="nombre" placeholder="Nombre" required>
          </div>

          <div class="input-box half"> <!-- Caja para apellido -->
            <i class="fas fa-user"></i>
            <input type="text" id="apellido" name="apellido" placeholder="Apellido" required>
          </div>

        </div>

        <div class="input-box"> <!-- Caja correo -->
          <i class="fas fa-envelope"></i>
          <input type="email" id="correo" name="correo" placeholder="Correo electrónico" required>
        </div>

        <div class="input-box"> <!-- Caja fecha de nacimiento -->
          <i class="fas fa-calendar"></i>
          <input type="date" id="nacimiento" name="nacimiento" required>
        </div>

        <div class="input-box"> <!-- Caja contraseña -->
          <i class="fas fa-lock"></i>
          <input type="password" id="password" name="clave" placeholder="Contraseña" required>
        </div>

        <div class="error-message" id="registro-error"></div> <!-- Mensaje error registro -->

        <button type="submit"> <!-- Botón crear cuenta -->
          <i class="fas fa-user-plus"></i>
          CREAR CUENTA
        </button>

      </form> <!-- Fin formulario registro -->
    </div>
    








<!-- olvidaste tu contraseña-->
    <div class="form-section hidden" id="correoOlvidoContraseña-section">
      <div class="logo-login"> <!-- Logo igual que en login -->
        <i class="fas fa-circle-play"></i>
        <h1>mixy</h1>
      </div>
      <h2>¿Olvidaste Tu Contraseña?</h2>
      <form id="olvidasteTuContraseñaCorreo">
        <div class="input-box"> <!-- Caja de entrada para correo -->
          <i class="fas fa-envelope"></i> <!-- Icono -->
          <input type="email" name="OlvidoContraseñaCorreo" id="OlvidoContraseñaCorreo" placeholder="Correo electrónico" required> <!-- Campo email -->
        </div>
        <div style="color: white; margin: 30px;"> Te enviaremos un correo para verificar tu cuenta</div>
        <div class="error-message " id="olvidasteContraseñaEnviarCodigo-error"></div>
        <button type="submit"> 
          <i class="fas fa-envelope"></i>
          ENVIAR CORREO
        </button>
      </form>
    </div>
<!-- codigo verificacion -->
    <div class="form-section hidden" id="codigoOlvidoContraseña-section">
      <div class="logo-login"> <!-- Contenedor del logo y nombre -->
        <i class="fas fa-circle-play"></i> <!-- Ícono del logo -->
        <h1>mixy</h1> <!-- Título del proyecto -->
      </div>
      <h2>¿Olvidaste Tu Contraseña?</h2>
      <form>
        <div class="input-box"> <!-- Caja contraseña -->
          <i class="fas fa-hashtag"></i>
          <input type="number" id="codigoOlvidasteContraseña" name="codigo" placeholder="Codigo" required >
        </div>
        <div style="color: white; margin: 30px;">Ingrese el codigo que se le envio al correo</div>
        <div class="error-message" id="olvidasteContraseñaComprobarCodigo-error"></div>
        <button type="submit"> 
          <i class="fas fa-key"></i>
          COMPROBAR CODIGO
        </button>
      </form>
    </div>
<!-- cambiar contraseña -->
    <div class="form-section hidden" id="cambiarOlvidoContraseña-section">
      <div class="logo-login"> <!-- Contenedor del logo y nombre -->
        <i class="fas fa-circle-play"></i> <!-- Ícono del logo -->
        <h1>mixy</h1> <!-- Título del proyecto -->
      </div>
      <h2>Cambiar Contraseña</h2>
      <form>
        <div class="input-box"> <!-- Caja contraseña -->
          <i class="fas fa-lock"></i>
          <input type="password" id="contraseña_cambiar" name="contraseña_cambiar" placeholder="Contraseña" required>
        </div>
        <div class="input-box"> <!-- Caja contraseña -->
          <i class="fas fa-lock"></i>
          <input type="password" id="confirmar_contraseña_cambiar" name="confirmar_contraseña_cambiar" placeholder="Confirmar Contraseña" required>
        </div>
        <div style="color: white; margin: 30px;">Ingrese la nueva contraseña</div>
        <div class="error-message" id="olvidasteContraseñaCambiarContraseña-error"></div>
        <button type="submit"> 
          <i class="fas fa-key"></i>
          CAMBIAR CONTRASEÑA
        </button>
      </form>
    </div>








    <!-- ======================== PANEL DESLIZANTE ======================== -->
    <div class="slide-panel" id="slide-panel"> <!-- Panel lateral animado -->

      <div class="slide-content" id="slide-content"> <!-- Contenido del panel -->

        <div class="slide-icon"> <!-- Icono decorativo -->
          <i class="fas fa-music"></i>
        </div>

        <h3 id="slide-title">¡Bienvenido a Mixy!</h3> <!-- Título dinámico -->

        <p id="slide-text">Descubre, escucha y disfruta de tu música favorita</p> <!-- Texto dinámico -->

        <button id="slide-btn"> <!-- Botón para alternar login/registro -->
          <i class="fas fa-user-plus"></i>
          Crear Cuenta
        </button>

      </div>

    </div> <!-- Fin slide panel -->

  </div> <!-- Fin contenedor principal -->

  <!-- ======================== SCRIPT JS ======================== -->
  <script>

    const btnSlide = document.getElementById("slide-btn"); // Botón que alterna login ↔ registro
    const loginSection = document.getElementById("login-section"); // Sección login
    const registroSection = document.getElementById("registro-section"); // Sección registro
    const slideTitle = document.getElementById("slide-title"); // Título del panel
    const slideText = document.getElementById("slide-text"); // Texto del panel


// variables menu cambiar contraseña
    const olvidoContraseñaEnlace = document.getElementById("OlvidoContraseñaEnlace")
    const correoOlvidoContraseñaSection = document.getElementById("correoOlvidoContraseña-section");
    const codigoOlvidoContraseñaSection = document.getElementById("codigoOlvidoContraseña-section");
    const cambiarOlvidoContraseñaSection = document.getElementById("cambiarOlvidoContraseña-section");
// fin variables menu cambiar contraseña


    let mostrando = "login"; // Variable que indica qué sección está activa
    // ================================================================
    //              CAMBIO ENTRE LOGIN Y REGISTRO
    // ================================================================
    btnSlide.addEventListener("click", () => { // Evento click del botón deslizante

      if (mostrando === "login") { // Si se muestra el login...

        loginSection.classList.add("hidden"); // Oculta login
        registroSection.classList.remove("hidden"); // Muestra registro

        //menus cambiar contraseña ocultar
        const olvidoContraseña = [correoOlvidoContraseñaSection, codigoOlvidoContraseñaSection, cambiarOlvidoContraseñaSection]
        olvidoContraseña.forEach(menu =>
          menu.classList.add("hidden")
        )
        //finmenus cambiar contraseña

        btnSlide.innerHTML = '<i class="fas fa-right-to-bracket"></i> Iniciar Sesión'; // Cambiar texto del botón
        slideTitle.textContent = "¿Ya tienes cuenta?"; // Cambiar título
        slideText.textContent = "Inicia sesión para acceder a tu biblioteca musical"; // Cambiar texto

        // Limpiar cualquier error existente
        document.getElementById("login-error").classList.remove("show");
        document.getElementById("registro-error").classList.remove("show");

        mostrando = "registro"; // Actualiza estado

      } else { // Si se está mostrando el registro...

        registroSection.classList.add("hidden"); // Oculta registro
        loginSection.classList.remove("hidden"); // Muestra login

        btnSlide.innerHTML = '<i class="fas fa-user-plus"></i> Crear Cuenta'; // Texto del botón
        slideTitle.textContent = "¡Bienvenido a Mixy!"; // Título
        slideText.textContent = "Descubre, escucha y disfruta de tu música favorita"; // Texto

        // Limpiar errores
        document.getElementById("login-error").classList.remove("show");
        document.getElementById("registro-error").classList.remove("show");

        mostrando = "login"; // Actualiza estado
      }
    });

    // ================================================================
    //                        REGISTRO
    // ================================================================
    document.getElementById("registro-form").addEventListener("submit", async (e) => {

      e.preventDefault(); // Evita recargar página

      const errorDiv = document.getElementById("registro-error"); // Div de error
      const submitBtn = e.target.querySelector('button[type="submit"]'); // Botón enviar

      errorDiv.classList.remove("show"); // Oculta error
      errorDiv.textContent = ""; // Limpia texto

      submitBtn.classList.add("loading"); // Animación de cargando
      submitBtn.disabled = true; // Deshabilita botón

      // Datos a enviar al backend
      const datos = {
        nombre: document.getElementById("nombre").value,
        apellido: document.getElementById("apellido").value,
        correo: document.getElementById("correo").value,
        nacimiento: document.getElementById("nacimiento").value,
        password: document.getElementById("password").value
      };

      try {

        // Solicitud POST al API
        const res = await fetch("/api/registro", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(datos)
        });

        const data = await res.json(); // Se convierte respuesta en JSON

        if (data.ok) { // Si la respuesta es correcta...

          e.target.reset(); // Limpia el formulario
          registroSection.classList.add("hidden"); // Oculta registro
          loginSection.classList.remove("hidden"); // Muestra login

          // Restaurar panel
          btnSlide.innerHTML = '<i class="fas fa-user-plus"></i> Crear Cuenta';
          slideTitle.textContent = "¡Bienvenido a Mixy!";
          slideText.textContent = "Descubre, escucha y disfruta de tu música favorita";

          mostrando = "login"; // Actualiza estado

          // Mensaje verde en login
          const loginError = document.getElementById("login-error");
          loginError.style.background = "rgba(29, 215, 96, 0.1)";
          loginError.style.borderColor = "rgba(29, 215, 96, 0.3)";
          loginError.style.color = "#1ED760";
          loginError.textContent = "✓ Cuenta creada exitosamente. Inicia sesión";
          loginError.classList.add("show");

          // Quitar mensaje después de 5 segundos
          setTimeout(() => {
            loginError.classList.remove("show");
            loginError.style.background = "";
            loginError.style.borderColor = "";
            loginError.style.color = "";
          }, 5000);

        } else { // Si el backend responde error...
          errorDiv.textContent = data.mensaje || "Error al registrar usuario";
          errorDiv.classList.add("show");
        }

      } catch (error) {

        errorDiv.textContent = "Error de conexión. Intenta nuevamente";
        errorDiv.classList.add("show");

      } finally {

        submitBtn.classList.remove("loading"); // Quitar animación
        submitBtn.disabled = false; // Habilitar botón
      }
    });

    // ================================================================
    //                             LOGIN
    // ================================================================
    document.getElementById("login-form").addEventListener("submit", async (e) => {

      e.preventDefault(); // Evita recargar página

      const errorDiv = document.getElementById("login-error"); // Div de error
      const submitBtn = e.target.querySelector('button[type="submit"]'); // Botón enviar

      errorDiv.classList.remove("show"); // Oculta error
      errorDiv.textContent = ""; // Limpia mensaje

      submitBtn.classList.add("loading"); // Cargando
      submitBtn.disabled = true; // Bloquea botón

      const datos = { // Datos del formulario
        correo: e.target.loginCorreo.value,
        password: e.target.loginClave.value
      };

      try {

        // Envío al backend
        const res = await fetch("/api/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(datos)
        });

        const data = await res.json(); // Respuesta backend

        if (data.ok) { // Si login es correcto...
          window.location.href = "/home"; // Redirigir a página principal

        } else { // Credenciales incorrectas
          errorDiv.textContent = data.mensaje || "Correo o contraseña incorrectos";
          errorDiv.classList.add("show");
        }

      } catch (error) { // Error conexión

        errorDiv.textContent = "Error de conexión. Intenta nuevamente";
        errorDiv.classList.add("show");

      }

      submitBtn.classList.remove("loading"); // Quitar animación
      submitBtn.disabled = false; // Reactivar boton
    });

    console.log("✅ Mixy login cargado"); // Mensaje en consola









//abrir olvido su contraseña, enlace
    olvidoContraseñaEnlace.addEventListener("click", ()=>{
      correoOlvidoContraseñaSection.classList.remove("hidden")
      loginSection.classList.add("hidden")
    })
// enviar correo
    const formularioCorreoOlvidarContraseña = document.getElementById("olvidasteTuContraseñaCorreo")
    formularioCorreoOlvidarContraseña.addEventListener("submit", async (e)=>{
      const submitBtn = e.target.querySelector('button[type="submit"]');
      e.preventDefault()
      submitBtn.classList.add("loading"); // Animación de cargando
      submitBtn.disabled = true; 
      const correoOlvidoContraseña = document.getElementById("OlvidoContraseñaCorreo").value
      const res = await fetch(`/correo_validacion/${correoOlvidoContraseña}`, {method:"POST"})
      const mensg = await res.json()
      if (mensg["codigo"]) {
        correoOlvidoContraseñaSection.classList.add("hidden")
        codigoOlvidoContraseñaSection.classList.remove("hidden")
      } else {
        const mensajeError = document.getElementById("olvidasteContraseñaEnviarCodigo-error")
        mensajeError.innerHTML = mensg["mensaje"]
        mensajeError.classList.add("show")
      }
      submitBtn.classList.remove("loading"); // Animación de cargando
      submitBtn.disabled = false; 
    })
//comprobar elcodigo
    codigoOlvidoContraseñaSection.addEventListener("submit", async (e)=>{
      const submitBtn = e.target.querySelector('button[type="submit"]');
      e.preventDefault()
      submitBtn.classList.add("loading"); // Animación de cargando
      submitBtn.disabled = true; 
      const codigoOlvidasteContraseña = document.getElementById("codigoOlvidasteContraseña").value
      const res = await fetch(`/validar_codigo/${codigoOlvidasteContraseña}`, {method: "POST"})
      const mensg = await res.json()
      if (mensg["codigo"]) {
        codigoOlvidoContraseñaSection.classList.add("hidden")
        cambiarOlvidoContraseñaSection.classList.remove("hidden")
      } else {
        const mensajeError = document.getElementById("olvidasteContraseñaComprobarCodigo-error")
        mensajeError.innerHTML = mensg["mensaje"]
        mensajeError.classList.add("show")
      }
      submitBtn.classList.remove("loading"); // Animación de cargando
      submitBtn.disabled = false; 
    })
// cambiar contraseña
    cambiarOlvidoContraseñaSection.addEventListener("submit", async (e)=>{
      const submitBtn = e.target.querySelector('button[type="submit"]');
      e.preventDefault()
      submitBtn.classList.add("loading"); // Animación de cargando
      submitBtn.disabled = true; 
      const olvidasteContraseñaCambiarContraseñaError = document.getElementById("olvidasteContraseñaCambiarContraseña-error")
      const contraseñaCambiar = document.getElementById("contraseña_cambiar").value
      const confirmarContraseñaCambiar = document.getElementById("confirmar_contraseña_cambiar").value
      if (!(contraseñaCambiar==confirmarContraseñaCambiar)) {
        olvidasteContraseñaCambiarContraseñaError.innerHTML = "Las contraseñas no son iguales"
        olvidasteContraseñaCambiarContraseñaError.classList.add("show")
      } else {
        const res = await fetch(`/cambiar_contraseña/${contraseñaCambiar}`, {method: "POST"})
        const mensg = await res.json()
        if (mensg["cambio"]) {
          cambiarOlvidoContraseñaSection.classList.add("hidden")
          loginSection.classList.remove("hidden")
          // Mensaje verde en login
          const loginError = document.getElementById("login-error");
          loginError.style.background = "rgba(29, 215, 96, 0.1)";
          loginError.style.borderColor = "rgba(29, 215, 96, 0.3)";
          loginError.style.color = "#1ED760";
          loginError.textContent = "✓ Contraseña Cambiada";
          loginError.classList.add("show");
          // Quitar mensaje después de 5 segundos
          setTimeout(() => {
            loginError.classList.remove("show");
            loginError.style.background = "";
            loginError.style.borderColor = "";
            loginError.style.color = "";
          }, 5000);
        } else {
          const olvidasteContraseñaCambiarContraseñaError = document.getElementById("olvidasteContraseñaCambiarContraseña-error")
          olvidasteContraseñaCambiarContraseñaError.innerHTML = mensg["mensaje"]
          olvidasteContraseñaCambiarContraseñaError.classList.add("show")
        }
      }
      submitBtn.classList.remove("loading"); // Animación de cargando
      submitBtn.disabled = false; 
    })

  </script>

</body> <!-- Fin del body -->
</html> <!-- Fin del documento -->